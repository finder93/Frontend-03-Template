学习笔记

-   组件化整合

    -   应用动画与手势到轮播组件

        -   轮播组件主要实现了自动轮播和鼠标控制轮播，这里把 2 种情况整合到一起，默认是自动轮播，鼠标点击或者说有手势操作的时候会取消自动轮播，鼠标移开或者手势操作结束会继续自动轮播。
        -   加上手势比较复杂，还需要处理鼠标点击或者手势操作后的一些情况。
            -   mousedown 或者手指按下的时候，首先是取消自动轮播，并且暂停时间线，如果是在图片移动过程中按下，则需要记录按照动画播放进度的偏移量减去 500（因为是从左向右轮播）的值，在移动事件里也就是 pan 里计算偏移的时候再减去这个值。为了确保能记录这个值，可以改造之前封装的手势库里的 Recognizer，在 start 方法里派发自定义的 start 事件，在监听 start 事件的时候记录值。计算动画播放进度需要用一个变量 t 记录当前时间，每次执行自动轮播的时候记录 t，监听 start 的时候用当前时间减去 t 就可以知道动画播放时间了
            -   mouseup 或手指松开的时候为了确保能恢复时间线重新执行自动轮播，同样需要改造手势库 Recognizer 的 end 方法，派发自定义的 end 事件，监听 end 事件去做这些操作
            -   如果派发了 flick 事件，这个时候没有移动超过一半的距离也可以认为应该移动到下一张图片，根据速度简单判断移动方向就可以了，最终图片元素 Animation 的 endValue 也要根据移动方向计算

    -   为组件添加更多属性

        -   前面轮播组件的 render 方法里用了不少局部变量，尤其是 position 用到了很多次，可以把 position 设计成 state，attributes 也可以和 state 统一放在 Component 里。这里还是用 Symbol 确保不会重名，当然写起来稍微有点别扭。
        -   然后是组件本身也应该有事件机制，语法可以参考 DOM 的事件，HTML 元素上以 on 开头，后面第一个字母大写，这样在 attributes 里可以根据事件名传递相应参数，可以在合适的时候派发这些自定义事件。

    -   加入 Children 机制

        -   前面组件的基本知识里提到了 Children 包括 Content 型 Children 与 Template 型 Children
            -   Content 型 Children 实现很容易，就是简单加了一个 childContainer 作为容器
            -   Template 型 Children 可以根据传入的 data 和渲染函数计算实际的 DOM 元素（类似 React 的 Render Props），还需要改造 createElement 支持 child 为数组的情况。轮播组件改造成这种形式也不复杂，也是一套很好的代码模板
